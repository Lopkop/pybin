{% extends "base.html" %} {% block content %}
<form action="" method="post" novalidate>
    {{ form.hidden_tag() }}
    <div class="box" id="box">
        <p>
            <input name="filename-0" type="text" placeholder="Filename" />
            <textarea name="value-0" id="editor-0" wrap="soft"></textarea>
        </p>
    </div>
    <button type="button" class="addNewPaste" id="addNewPaste">Add file</button>
    <button type="button" class="RemovePaste" id="RemovePaste">
        Remove file
    </button>
    {{ form.submit(type='submit', class='ghost-button btn btn-outline-dark') }}
</form>
<script>
    var editor = CodeMirror.fromTextArea(document.getElementById("editor-0"), {
        lineNumbers: true,
        mode: "text/x-python",
        theme: "dracula",
    });

    var fieldNum = 0;
    var div = document.getElementById("box");
    var filename = document.createElement("input");
    var value = document.createElement("textarea");
    var button = document.getElementById("addNewPaste");
    var removeButton = document.getElementById("RemovePaste");

    button.addEventListener("click", function () {
        fieldNum += 1;
        filename.name = "filename-" + fieldNum;
        filename.placeholder = "Filename";
        div.append(filename.cloneNode(true));

        value.name = "value-" + fieldNum;
        value.id = "editor-" + fieldNum;
        div.append(value.cloneNode(true));

        var editor = CodeMirror.fromTextArea(
            document.getElementById("editor-" + fieldNum),
            {
                lineNumbers: true,
                mode: "text/x-python",
                theme: "dracula",
            },
        );
    });

    removeButton.addEventListener("click", function () {
        console.log(fieldNum);
        if (fieldNum < 1) {
            return;
        }
        let editor = document.getElementById("editor-" + fieldNum);
        let codemirror =
            document.getElementsByClassName("CodeMirror")[fieldNum];
        codemirror.remove();
        editor.remove();
        let filename = document.getElementsByName("filename-" + fieldNum)[0];
        filename.remove();
        fieldNum -= 1;
    });
</script>
{% endblock %}
